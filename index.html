<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FS Dive Generator</title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
</head>
<body>

<!--Content-->
<h1>FS Dive Generator</h1>
<div id="dives"></div>

<form>
    <label for="divePool">Discipline:</label>
    <select id="divePool" onchange="changePool()">
        <option value="4-way_fs">4-way</option>
        <option value="8-way_fs">8-way</option>
    </select>
    <br>

    <label for="numDives">Number of dives:</label>
    <input id="numDives" type="number" min="1" max="99" value="10" required>
    <br>

    <label for="points">Number of points:</label>
    <select id="points">
        <option value="3">3 - 4</option>
        <option value="4">4 - 5</option>
        <option value="5">5 - 6</option>
    </select>
    <br>

    <div>
        <input type="radio" id="blocksAndRandoms" name="blocksAndRandoms" value="{}" checked/>
        <label for="blocksAndRandoms">Randoms & Blocks</label>

        <input type="radio" id="onlyRandoms" name="blocksAndRandoms" value='{"useBlocks":false}'/>
        <label for="onlyRandoms">Only Randoms</label>

        <input type="radio" id="onlyBlocks" name="blocksAndRandoms" value='{"useRandoms":false}'/>
        <label for="onlyBlocks">Only Blocks</label>
    </div>

    <input type="checkbox" id="uniqueExits">
    <label for="uniqueExits">Unique Exits</label>
    <br>

    <input type="checkbox" id="showImage">
    <label for="showImage">Display images below (forces light-mode)</label>
    <br>

    <button type="button" onclick="addToPage()">Generate dives</button>
    <button type="button" onclick="copyToClipboard()">Copy dives to clipboard</button>
    <button type="button" onclick="window.print()">Save dives as PDF</button>
</form>

<div id="diveImages" class="toPrint"></div>

<div id="copyClipboardToast" class="toast">Copied to clipboard</div>


<!--Scripts-->
<script src="assets/diagrams/4-way_fs/rhythm/index.js"></script> <!--Load all 4-way images-->
<script src="assets/diagrams/8-way_fs/rhythm/index.js"></script> <!--Load all 8-way images-->
<script src="index.js"></script>
<script>
    let imagePaths = imagePaths4Way; // Used by divesAsImages()
    const divePool = document.getElementById("divePool");

    function changePool() {
        if (divePool.value === "4-way_fs") {
            imagePaths = imagePaths4Way;
        } else {
            imagePaths = imagePaths8Way;
        }

        // Reload the images
        document.getElementById("diveImages").innerHTML = divesAsImages(generatedDives);
    }
</script>
<script>
    let generatedDives;
    const numDives = document.getElementById("numDives");
    const minPoints = document.getElementById("points");
    const uniqueExits = document.getElementById("uniqueExits");

    function addToPage() {
        if (numDives.checkValidity() && minPoints.checkValidity()) {
            generatedDives = main({
                numDives: numDives.value,
                minPoints: minPoints.value,
                uniqueExits: uniqueExits.checked,
                ...JSON.parse(document.querySelector('input[name="blocksAndRandoms"]:checked').value),
            });
            document.getElementById("dives").innerHTML = listDives(generatedDives);
            document.getElementById("diveImages").innerHTML = divesAsImages(generatedDives);
        }
    }
    addToPage();
</script>
<script>
    const toast = document.getElementById("copyClipboardToast");
    let toastTimeout;

    // Reset animation by removing and re-adding the class
    function refreshToast() {
        toast.classList.remove("show");
        toast.classList.add('noTransition'); // Disable transitions
        toast.offsetHeight; // Trigger a reflow, flushing the CSS changes
        toast.classList.remove('noTransition'); // Re-enable transitions
        toast.classList.add("show");

        clearTimeout(toastTimeout); // Clear existing timeout, if any
    }

    function copyToClipboard() {
        navigator.clipboard.writeText(document.getElementById("dives").innerText);

        // Display a toast notification
        refreshToast();
        toastTimeout = setTimeout(() => toast.classList.remove("show"), 1250);
    }
</script>
<noscript>To use this tool, please enable JavaScript.</noscript>

</body>
</html>
